---
- name: remove original index.hml
  file: state=absent path=/var/www/html/index.html

- name: ensure clone destination exists
  file: state=directory path={{ install_dir }}

- name: clear install directory #FIXME: neměl bych mazat celou aplikaci jen kvůli GITu
  shell: rm -r {{ install_dir }}

- name: clone repository
  git:
    repo=https://github.com/mrtnzlml/hhvm-nette
    dest={{ install_dir }}
    recursive=yes
  register: git_result

- name: make log dir writable
  file: state=directory path={{ install_dir }}/log mode=0777

- name: ensure temp dir exists
  file: state=directory path={{ install_dir }}/temp mode=0777

- name: clear cache directory
  when: git_result.changed
  shell: rm -rfv {{ install_dir }}/temp/cache/*

- name: install composer packages
  when: git_result.changed
  composer:
    working_dir: '{{ install_dir }}'

- name: create www/components directory for Bower components
  file: state=directory path={{ install_dir }}/www/components

- name: install Bower dependencies
  bower: path={{ install_dir }}
